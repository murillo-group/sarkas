  

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Pre Simulation Testing &mdash; Sarkas 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="H-He Mixture Simulation" href="../examples/H-He_Mixture.html" />
    <link rel="prev" title="Input File" href="input_file.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo_orange_gray_v3.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../why_sarkas/why_sarkas.html">Why Sarkas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/Quickstart.html">Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_file.html">Input File</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pre Simulation Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Simulation-Parameters">Simulation Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Sarkas-Figlet">Sarkas Figlet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Warnings">Warnings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Simulation">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Initialization-Times">Initialization Times</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Time-Estimates">Time Estimates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Force-Error">Force Error</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Post-Processing">Post Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Radial-Distribution-Function">Radial Distribution Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Static-Structure-Factor">Static Structure Factor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Dynamic-Structure-Factor-and-Current-Correlation-Function">Dynamic Structure Factor and Current Correlation Function</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/H-He_Mixture.html">H-He Mixture Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/QSP_Tutorial.html">Quantum Statistical Potential Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Magnetized_Plasma.html">Magnetized Plasma</a></li>
</ul>
<p class="caption"><span class="caption-text">Theoretical Background:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../theory/integrators.html">Integrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/potentials.html">Potentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/thermostats.html">Thermostats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/PPPM.html">Particle-Particle Particle-Mesh Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/force_error.html">Force Error</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/references.html">References</a></li>
</ul>
<p class="caption"><span class="caption-text">Code Development:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/code_dev.html">Guidelines</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">sarkas</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sarkas</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Pre Simulation Testing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorial/Pre_Simulation_Testing.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Pre-Simulation-Testing">
<h1>Pre Simulation Testing<a class="headerlink" href="#Pre-Simulation-Testing" title="Permalink to this headline">¶</a></h1>
<p>Now that we have created our input file we need to verify that our simulation parameters will give a good simulation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Import the usual libraries</span>
<span class="o">%</span><span class="k">pylab</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;MSUstyle&#39;</span><span class="p">)</span>

<span class="c1"># Import sarkas</span>
<span class="kn">from</span> <span class="nn">sarkas.processes</span> <span class="kn">import</span> <span class="n">Simulation</span><span class="p">,</span> <span class="n">PostProcess</span><span class="p">,</span> <span class="n">PreProcess</span>

<span class="c1"># Create the file path to the YAML input file</span>
<span class="n">input_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;tutorial_yaml_files&#39;</span><span class="p">,</span> <span class="s1">&#39;yukawa_mks_p3m.yaml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Using matplotlib backend: Qt5Agg
Populating the interactive namespace from numpy and matplotlib
</pre></div></div>
</div>
<div class="section" id="Simulation-Parameters">
<h2>Simulation Parameters<a class="headerlink" href="#Simulation-Parameters" title="Permalink to this headline">¶</a></h2>
<p>Let’s verify that our input parameters</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">preproc</span> <span class="o">=</span> <span class="n">PreProcess</span><span class="p">(</span><span class="n">input_file_name</span><span class="p">)</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">read_yaml</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span style="color: rgb(24,69,49)">








 _______  _______  _______  _        _______  _______
(  ____ \(  ___  )(  ____ )| \    /\(  ___  )(  ____ \
| (    \/| (   ) || (    )||  \  / /| (   ) || (    \/
| (_____ | (___) || (____)||  (_/ / | (___) || (_____
(_____  )|  ___  ||     __)|   _ (  |  ___  |(_____  )
      ) || (   ) || (\ (   |  ( \ \ | (   ) |      ) |
/\____) || )   ( || ) \ \__|  /  \ \| )   ( |/\____) |
\_______)|/     \||/   \__/|_/    \/|/     \|\_______)


</span>
An open-source pure-python molecular dynamics code for non-ideal plasmas.

WARNING: Equilibration temperatures not defined. I will use the species&#39;s temperatures.


======================= Simulation ==========================

Job ID:  yocp
Job directory:  Simulations/yocp_pppm
Equilibration dumps directory:  Simulations/yocp_pppm/Equilibration/dumps
Production dumps directory:  Simulations/yocp_pppm/Production/dumps

Units:  mks
Total No. of particles =  10000

Particle Species:
No. of species =  1
Species 1 : H
        Species ID: 0
        No. of particles = 10000
        Number density = 1.620000e+32 [N/m^3]
        Mass = 1.673000e-27 [kg]
        Charge = 1.602177e-19 [C]
        Temperature = 1.160452e+04 [K]

Lengths scales:
Wigner-Seitz radius = 1.137973e-11 [m]
No. of non-zero box dimensions =  3
Box length along x axis = 3.472931e+01 a_ws = 3.952104e-10 [m]
Box length along y axis = 3.472931e+01 a_ws = 3.952104e-10 [m]
Box length along z axis = 3.472931e+01 a_ws = 3.952104e-10 [m]
The remaining lengths scales are given in [m]

Boundary conditions: periodic

Thermostat:  Berendsen
Berendsen Relaxation rate: 0.200
Thermostating Temperatures:  [11604.51812]

Potential:  Yukawa
kappa = 7.2490e-01
lambda_TF = 1.5698e-11 [m]
Gamma_eff = 126.54

Algorithm:  P3M
Ewald parameter alpha = 0.6220 / a_ws = 5.465900e+10 [1/m]
Mesh size * Ewald_parameter (h * alpha) = 0.3375, 0.3375, 0.3375
                                        ~ 1/2, 1/2, 1/2
rcut = 5.5100 a_ws = 6.270200e-11 [m]
Mesh = 64 x 64 x 64
No. of PP cells per dimension =  6,  6,  6
No. of particles in PP loop =   1078
No. of PP neighbors per particle =    167
PM Force Error = 4.634770e-06
PP Force Error = 2.348380e-06
Tot Force Error = 5.195766e-06

Integrator:  Verlet

Time scales:
Time step = 6.087000e-18 [s]
Total plasma frequency = 1.675504e+16 [Hz]
w_p dt = 0.1020
No. of equilibration steps = 1000 ~ 101 w_p T_eq
snapshot interval = 5 = 0.510 w_p T_snap
No. of post-equilibration steps = 5000 ~ 509 w_p T_prod
snapshot interval = 2 = 0.204 w_p T_snap


----------------- Initialization Times -----------------------

Potential Initialization Time: 0 hrs 0 min 5 sec

Particles Initialization Time: 0 sec 1 msec 237 usec 386 nsec

Total Simulation Initialization Time: 0 hrs 0 min 5 sec
</pre></div></div>
</div>
<p>As you can see the output is rather verbose, so let’s unpack it.</p>
<div class="section" id="Sarkas-Figlet">
<h3>Sarkas Figlet<a class="headerlink" href="#Sarkas-Figlet" title="Permalink to this headline">¶</a></h3>
<p>The first screen output is the Sarkas Figlet. This is printed at the beginning of every <code class="docutils literal notranslate"><span class="pre">sarkas.processes</span></code> by the static method <code class="docutils literal notranslate"><span class="pre">screen_figlet()</span></code> of the <code class="docutils literal notranslate"><span class="pre">InputOutput</span></code> class. The Figlet font and colors are chosen randomly from a predefined set in <code class="docutils literal notranslate"><span class="pre">sarkas.utilities.io</span></code>. This function assumes a white background if you are running a Jupyter notebook, while a dark background in the case of an IPython/Python kernel.</p>
</div>
<div class="section" id="Warnings">
<h3>Warnings<a class="headerlink" href="#Warnings" title="Permalink to this headline">¶</a></h3>
<p>Right after the Sarkas Figlet warnings regarding inputs from the YAML file will be printed. In this case we did not define the equilibration temperatures in the <code class="docutils literal notranslate"><span class="pre">Thermostat</span></code> section of the YAML file. Another possible warnings is too large of a cut-off radius for the potential.</p>
</div>
<div class="section" id="Simulation">
<h3>Simulation<a class="headerlink" href="#Simulation" title="Permalink to this headline">¶</a></h3>
<p>Next we have the <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> section where all simulation parameters are printed. These include inputs from the YAML file and calculated constants. For example, we find the value of the Wigner-Seitz radius, <code class="docutils literal notranslate"><span class="pre">a_ws</span></code>, the number of non zero dimensions, and the length of the simulation box sides in terms of <code class="docutils literal notranslate"><span class="pre">a_ws</span></code> and its numerical value in the chosen units.</p>
<p>Few lines below we find Potential info. Note that this section depends on the type of potential and as such it varies. Next we find the Algorithm section. This is particularly verbose in the case of the PPPM algorithm since we have parameters for the PP and PM part of the algorithm. We will come back to this number later in the discussion</p>
</div>
<div class="section" id="Initialization-Times">
<h3>Initialization Times<a class="headerlink" href="#Initialization-Times" title="Permalink to this headline">¶</a></h3>
<p>In this section are indicated the times for the initialization part of the simulation. These times are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Potential</span> <span class="pre">Initialization</span></code> where the all the potential parameters, including the Optimal Green’s function in the case of PPPM algorithm, are calculated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Particles</span> <span class="pre">Initialization</span></code> where the particles positions and velocities are initialized. This includes the case where a specific particles distribution is chosen.</p></li>
</ul>
</div>
</div>
<div class="section" id="Time-Estimates">
<h2>Time Estimates<a class="headerlink" href="#Time-Estimates" title="Permalink to this headline">¶</a></h2>
<p>The above output is intended to be a check on the choice of parameters. The <code class="docutils literal notranslate"><span class="pre">PreProcess</span></code> class provides also an estimate of the various phases of a simulation. The times are estimated by running several step of the simulation and average over them. This is done by the method <code class="docutils literal notranslate"><span class="pre">run()</span></code> of the <code class="docutils literal notranslate"><span class="pre">PreProcess</span></code> class.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">preproc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">timing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># time estimation, default is True</span>
    <span class="n">loops</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>   <span class="c1"># the number of timesteps to average, Default is 10</span>
           <span class="p">)</span>
<span class="c1"># Note that the argument `loops` should be chosen to be larger than `production_dump_step`</span>
<span class="c1"># in order to get a more accurate estimate.</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


====================== Times Estimates ===========================

Optimal Green&#39;s Function Time:
0 min 0 sec 4 msec 18 usec 2 nsec

Time of PP acceleration calculation averaged over 10 steps:
0 min 0 sec 190 msec 545 usec 232 nsec

Time of PM acceleration calculation averaged over 10 steps:
0 min 0 sec 269 msec 534 usec 64 nsec


Running 10 equilibration and production steps to estimate simulation times

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c4734b2ef7c242d5a1a5cc01969edc65", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Time of a single equilibration step averaged over 10 steps:
0 min 0 sec 295 msec 394 usec 48 nsec

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7a6e4136e3e5428a96eb6dff58705c40", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Time of a single production step averaged over 10 steps:
0 min 0 sec 249 msec 424 usec 853 nsec



----------------- Total Estimated Times -----------------------

Equilibration Time: 0 hrs 4 min 55 sec

Production Time: 0 hrs 20 min 47 sec

Total Run Time: 0 hrs 25 min 42 sec
</pre></div></div>
</div>
<p>The first part of the output shows the times needed for the force calculation and the averaged time for an equilibration and production time step.</p>
<p>As you can see the calculation of the optimal Green’s function takes a relatively long time. Fortunately this needs be calculated once at the beginning of the simulation. We note also that the PM part takes ~1.5x the time it takes for the PP part. This is specific to this hardware and the opposite case could be true on other machines.</p>
<p>Next Sarkas will run <code class="docutils literal notranslate"><span class="pre">loops</span></code> timesteps for each phase to estimate the time of each. These are indicated by the green bars, a nice feature from the <code class="docutils literal notranslate"><span class="pre">tqdm</span></code> package. Below the green bars we find the average time of each phase. Note that the equilibration phase takes longer than the production phase. This is due to the presence of athermostat.</p>
<p>At the end all the estimates are put together to calculate the equilibration, production, and total run times.</p>
<p>The Equilibration and Production times are then calculated by multiplying the above times by <code class="docutils literal notranslate"><span class="pre">equilibration_steps</span></code> and <code class="docutils literal notranslate"><span class="pre">production_steps</span></code>, respectively.</p>
<blockquote>
<div><p><strong>NOTE:</strong> These times will vary depending on the computer hardware. For this tutorial we used a 2019 Dell XPS 8930 with Intel Core i7-8700K &#64; 3.70Ghz and 48GB of RAM running Ubuntu 18.04.</p>
</div></blockquote>
</div>
<div class="section" id="Force-Error">
<h2>Force Error<a class="headerlink" href="#Force-Error" title="Permalink to this headline">¶</a></h2>
<p>As promised we return now to the explanation of the parameters in the Algorithm section of the Simulation output.</p>
<p>The two important parameters in this section are: the Ewald parameter <span class="math notranslate nohighlight">\(\alpha\)</span> and the cutoff radius, <span class="math notranslate nohighlight">\(r_c\)</span>. Below the line <code class="docutils literal notranslate"><span class="pre">Mesh</span> <span class="pre">=</span> <span class="pre">[64</span> <span class="pre">64</span> <span class="pre">64]</span></code> the number of cells per dimension for the Linked Cell algorithm and the number of particles inside a spheres of radius <span class="math notranslate nohighlight">\(r_c\)</span>. Next we find the most important information: the error in the force calculation. This is the error incurred when we cut the potential interaction after a certain distance. For more details on the way this is
calculated see the page <a class="reference external" href="../theory/force_error.html">Force Error</a>. This number is dimensionless since all the variable have been rescaled. There is no <em>good</em> value for the Force error and it is up to the user to decide. In Non-Ideal plasmas it is usually chosen to be less than <code class="docutils literal notranslate"><span class="pre">1e-5</span></code>. In this case we have <code class="docutils literal notranslate"><span class="pre">Tot</span> <span class="pre">Force</span> <span class="pre">Error</span> <span class="pre">=</span> <span class="pre">5.195766e-06</span></code>.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">pppm_approximation()</span></code> of the <code class="docutils literal notranslate"><span class="pre">PreProcess</span></code> class calculates estimates of <code class="docutils literal notranslate"><span class="pre">Tot</span> <span class="pre">Force</span> <span class="pre">Error</span></code> for several <span class="math notranslate nohighlight">\(r_c\)</span> and <span class="math notranslate nohighlight">\(\alpha\)</span> parameters. This time the output will be two figures. These two figures are meant to help the user find the optimal PPPM parameters.</p>
<p>Note that the same plots can be obtained by choosing <code class="docutils literal notranslate"><span class="pre">pppm_plots=True</span></code> as an argument in <code class="docutils literal notranslate"><span class="pre">run()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">preproc</span><span class="o">.</span><span class="n">pppm_approximation</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Pre_Simulation_Testing_10_0.png" src="../_images/tutorial_Pre_Simulation_Testing_10_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_Pre_Simulation_Testing_10_1.png" src="../_images/tutorial_Pre_Simulation_Testing_10_1.png" />
</div>
</div>
<p>The first figure is a contour map in the <span class="math notranslate nohighlight">\((r_c,\alpha)\)</span> parameters space of</p>
<div class="math notranslate nohighlight">
\[\Delta F_{\textrm{tot}}^{(\textrm{approx})}( r_c, \alpha) = \sqrt{ \Delta F_{\rm PP}^2 +
           ( \Delta F_{\rm PM}^{(\textrm{approx})} ) ^2 }\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta F_{\rm PP}\)</span> is the <code class="docutils literal notranslate"><span class="pre">PP</span> <span class="pre">Force</span> <span class="pre">Error</span></code>. <span class="math notranslate nohighlight">\(\Delta F_{\rm PM}^{(\textrm{approx})}\)</span> is calculated from an approximation of the PM force error, hence the superscript <span class="math notranslate nohighlight">\(\rm approx\)</span>, and its functional form is different than the one calculated in <code class="docutils literal notranslate"><span class="pre">PM</span> <span class="pre">Force</span> <span class="pre">Error</span></code>. See <a class="reference internal" href="../theory/force_error.html"><span class="doc">Force Error</span></a> for more detail. The numbers on the white contours indicate the value of <span class="math notranslate nohighlight">\(\Delta F_{\textrm{tot}}^{(\textrm{apprx})}\)</span> along those lines and the black dot
indicates our choice of parameters. Notice that our parameter choice falls in the region in between <code class="docutils literal notranslate"><span class="pre">1e-5</span></code> and <code class="docutils literal notranslate"><span class="pre">1e-6</span></code> as expected, recall <code class="docutils literal notranslate"><span class="pre">Tot</span> <span class="pre">Force</span> <span class="pre">Error</span> <span class="pre">=</span> <span class="pre">5.195766e-06</span></code>. Furthermore, this plot tells us that if we want a force error of the order 1e-6 we need to choose values that fall into the small purple triangle at the top.</p>
<p>However, our choice of parameters while being good, it might not be optimal. In order to find the best choice we look at the second figure.</p>
<p>The left panel is a plot of <span class="math notranslate nohighlight">\(\Delta F_{\textrm{tot}}^{(\textrm{approx})}\)</span> vs <span class="math notranslate nohighlight">\(r_c/a_{\rm ws}\)</span> at five different values of <span class="math notranslate nohighlight">\(\alpha a_{\rm ws}\)</span> while the right panel is a plot of <span class="math notranslate nohighlight">\(\Delta F_{\textrm{tot}}^{(\textrm{approx})}\)</span> vs <span class="math notranslate nohighlight">\(\alpha a_{\rm ws}\)</span> at five different values of <span class="math notranslate nohighlight">\(r_c/a_{\rm ws}\)</span>. The vertical black dashed lines indicate our choice of <span class="math notranslate nohighlight">\(\alpha a_{\rm ws}\)</span> and <span class="math notranslate nohighlight">\(r_c/a_{\rm ws}\)</span>. The horizontal black dashed lines, instead, indicate the value
<code class="docutils literal notranslate"><span class="pre">Tot</span> <span class="pre">Force</span> <span class="pre">Error</span> <span class="pre">=</span> <span class="pre">5.195766e-06</span></code>.</p>
<p>These plots show that our analytical approximation is a very good approximation and that our choice of parameters is optimal as the intersection of the dashed lines falls exactly in the minimum of the curves. From the left panel we find that larger values for <span class="math notranslate nohighlight">\(r_c = 5.51\)</span> lead to an inefficient code since we will be calculating the interaction for many more particles without actually reducing the force error. Similarly, the right panel shows that our choice of <span class="math notranslate nohighlight">\(r_c\)</span> is close to
optimal given <span class="math notranslate nohighlight">\(\alpha a_{ws} = 0.614\)</span>.</p>
<p>Some good rules of thumb to keep in mind while choosing the parameters are</p>
<ul class="simple">
<li><p>larger (smaller) <span class="math notranslate nohighlight">\(\alpha\)</span> lead to a smaller (larger) PM error, but to a larger (smaller) PP error,</p></li>
<li><p>larger (smaller) <span class="math notranslate nohighlight">\(r_c\)</span> lead to a smaller (greater) PP part but do not affect the PM error,</p></li>
<li><p>keep an eye on the PM and PP calculation times.</p></li>
<li><p>larger <span class="math notranslate nohighlight">\(r_c\)</span> lead to a longer time spent in calculating the PP part of the force since there are more neighbors,</p></li>
<li><p>larger or smaller <span class="math notranslate nohighlight">\(\alpha\)</span> do not affect the PM calculation time since this depends on the number of mesh points,</p></li>
<li><p>choose the number of mesh points to be a power of 2 since FFT algorithms are most efficient in this case.</p></li>
</ul>
<blockquote>
<div><p><strong>NOTE:</strong> The above investigation is useful in choosing the parameters <span class="math notranslate nohighlight">\(r_c\)</span> and <span class="math notranslate nohighlight">\(\alpha\)</span> for fixed values of the charge approximation order, <span class="math notranslate nohighlight">\(p\)</span>, the number of mesh points, <span class="math notranslate nohighlight">\(M_x = M_y = M_z\)</span>, and number of aliases <span class="math notranslate nohighlight">\(m_x = m_y = m_z\)</span>.</p>
</div></blockquote>
</div>
<div class="section" id="Post-Processing">
<h2>Post Processing<a class="headerlink" href="#Post-Processing" title="Permalink to this headline">¶</a></h2>
<p>All the above information are needed in order to run a simulation and produce data to be analyzed in the post-processing phase. However, the optimal choice of the above parameters does not necessarily indicate that our desired physical observable is calculated correctly. Thus, we need to verify that our choices lead to the desired physical result.</p>
<p>By setting <code class="docutils literal notranslate"><span class="pre">postprocessing=True</span></code> as the argument of <code class="docutils literal notranslate"><span class="pre">run()</span></code> we will print the parameters of the physical observables that we decided to calculate in the <code class="docutils literal notranslate"><span class="pre">PostProcessing</span></code> section of the YAML file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">preproc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">timing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">postprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


===================== Post Processing ============================

Radial Distribution Function:
No. bins = 500
dr = 0.0110 a_ws = 1.2540e-13 [m]
Maximum Distance (i.e. potential.rc)= 5.5100 a_ws = 6.2702e-11 [m]

Static Structure Factor:
No. of ka harmonics = n_x, n_y, n_z = 10, 10, 10
No. of ka values to calculate = 1330
Smallest wavevector k_min = 3.9 / N^(1/3)
k_min = 0.1809 / a_ws = 2.5303e+09 [1/m]
Largest wavevector k_max = k_min * sqrt( n_x^2 + n_y^2 + n_z^2)
k_max = 3.1336 / a_ws = 4.3826e+10 [1/m]

Dynamic Structure Factor:
Frequency Constants
        No. of slices = 1
        No. steps per slice = 2500
        No. dumps per slice = 1250
        Frequency step dw = 2 pi (no_slices * prod_dump_step)/(production_steps * dt)
        dw = 0.0246 w_p = 4.1289e+14 [Hz]
        Maximum Frequency w_max = 2 pi /(prod_dump_step * dt)
        w_max = 15.4018 w_p = 2.5806e+17 [Hz]
Wavevector Constants
        No. of ka harmonics = n_x, n_y, n_z = 10, 10, 10
        No. of ka values to calculate = 1330
        Smallest wavevector k_min = 3.9 / N^(1/3)
        k_min = 0.1809 / a_ws = 2.5303e+09 [1/m]
        Largest wavevector k_max = k_min * sqrt( n_x^2 + n_y^2 + n_z^2)
        k_max = 3.1336 / a_ws = 4.3826e+10 [1/m]

Current Correlation Function:
Frequency Constants
        No. of slices = 1
        No. steps per slice = 2500
        No. dumps per slice = 1250
        Frequency step dw = 2 pi (no_slices * prod_dump_step)/(production_steps * dt)
        dw = 0.0246 w_p = 4.1289e+14 [Hz]
        Maximum Frequency w_max = 2 pi /(prod_dump_step * dt)
        w_max = 15.4018 w_p = 2.5806e+17 [Hz]
Wavevector Constants
        No. of ka harmonics = n_x, n_y, n_z = 10, 10, 10
        No. of ka values to calculate = 1330
        Smallest wavevector k_min = 3.9 / N^(1/3)
        k_min = 0.1809 / a_ws = 2.5303e+09 [1/m]
        Largest wavevector k_max = k_min * sqrt( n_x^2 + n_y^2 + n_z^2)
        k_max = 3.1336 / a_ws = 4.3826e+10 [1/m]
</pre></div></div>
</div>
<div class="section" id="Radial-Distribution-Function">
<h3>Radial Distribution Function<a class="headerlink" href="#Radial-Distribution-Function" title="Permalink to this headline">¶</a></h3>
<p>The most common physical observable is the Radial Distribution Function (RDF). Our choice of <code class="docutils literal notranslate"><span class="pre">Parameters.rdf_nbins</span> <span class="pre">:</span> <span class="pre">500</span></code> and <code class="docutils literal notranslate"><span class="pre">Potential.rc</span> <span class="pre">:</span> <span class="pre">6.2702e-11</span></code> leads to <code class="docutils literal notranslate"><span class="pre">dr</span> <span class="pre">=</span> <span class="pre">0.0110</span> <span class="pre">a_ws</span></code> and <code class="docutils literal notranslate"><span class="pre">r_max</span> <span class="pre">=</span> <span class="pre">5.5100</span> <span class="pre">a_ws</span></code>. If we desire to have a larger <code class="docutils literal notranslate"><span class="pre">r_max</span></code> we will need to increase <code class="docutils literal notranslate"><span class="pre">potential.rc</span></code>. As mentioned above this might lead to an inefficient force calculation, but the force error plots can help us find an optimal <code class="docutils literal notranslate"><span class="pre">alpha</span></code> for a larger <code class="docutils literal notranslate"><span class="pre">rcut</span></code></p>
</div>
<div class="section" id="Static-Structure-Factor">
<h3>Static Structure Factor<a class="headerlink" href="#Static-Structure-Factor" title="Permalink to this headline">¶</a></h3>
<p>The Fourier transform of the RDF leads to the Static Structure Factor (SSF). The important parameters for the SSF is the desired range of wavevectors to calculate. The output shows the chosen number of harmonics of the smallest wavevector in each of cartesian directions. These are the same values in the YAML file.</p>
<p>Next, we find the total number of <span class="math notranslate nohighlight">\(\mathbf k\)</span> (vectors) that will be calculated. This number corresponds to the total number of combinations of the three harmonics directions, <code class="docutils literal notranslate"><span class="pre">n_x</span> <span class="pre">*</span> <span class="pre">n_y</span> <span class="pre">*</span> <span class="pre">n_z</span> <span class="pre">-</span> <span class="pre">1</span></code> .</p>
<p>The smallest <span class="math notranslate nohighlight">\(\mathbf k\)</span> vector that can be fitted int the simulation box is given by the length of the longest side of the simulation box, <span class="math notranslate nohighlight">\(L\)</span>. This is computed from the total number of particles, <span class="math notranslate nohighlight">\(N\)</span>.</p>
<div class="math notranslate nohighlight">
\[k_{\rm min} = \frac{2\pi}{L} \approx \frac{3.9}{N^{1/3}}\]</div>
<p>In this case, $k_{<span class="math">\rm min</span>} a_{<span class="math">\rm ws</span>} = 0.1809 $, if we need to investigate smaller wavevectors we need to increase the number of particles. The above equation can be used to find the value of <span class="math notranslate nohighlight">\(N\)</span> for the desired <span class="math notranslate nohighlight">\(k_{\rm min}\)</span> value.</p>
<p>The largest wavevector, instead, is defined by our choice of the harmonics.</p>
<div class="math notranslate nohighlight">
\[k_{\rm max} = \frac{2 \pi}{L} \sqrt{n_x^2 + n_y^2 + n_z^2}.\]</div>
</div>
<div class="section" id="Dynamic-Structure-Factor-and-Current-Correlation-Function">
<h3>Dynamic Structure Factor and Current Correlation Function<a class="headerlink" href="#Dynamic-Structure-Factor-and-Current-Correlation-Function" title="Permalink to this headline">¶</a></h3>
<p>These two functions depend on the same parameters. However, it can be the case that only one of the two is calculated, hence, a section for each of them. The parameters are divided in two sections, frequency and wavevector constants. The wavevectors constants are the same as those in SSF. This is due to the fact that the <span class="math notranslate nohighlight">\(\mathbf k\)</span> data is saved once computed the first time. Any subsequent calculation requiring this data will read in the saved data and not recompute it. Therefore it is
important to check that the parameters in the YAML file are the same.</p>
<p>As per the frequency constants, the first parameters is the number of slices. This indicates the number in which to divide the timeseries data. A DSF (or CCF) will be calculated for each slice and the final result will be an average over all the slices. The important parameters are then the frequency step and the maximum frequency calculated from the FFT. For each of these values, the corresponding equation is given so to help the user decide the correct parameters. The maximum frequency is
given by</p>
<div class="math notranslate nohighlight">
\[\omega_{\rm max} = \frac{\pi}{d_s \Delta t }\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta t\)</span> is the timestep and <span class="math notranslate nohighlight">\(d_s\)</span> the snapshot interval (<code class="docutils literal notranslate"><span class="pre">prod_dump_step</span></code>). The frequency step instead is</p>
<div class="math notranslate nohighlight">
\[\Delta \omega = 2\pi \frac{d_s N_s}{M_T \Delta t}\]</div>
<p>where <span class="math notranslate nohighlight">\(N_s\)</span> is the number of slices (<code class="docutils literal notranslate"><span class="pre">no_slices</span></code>), <span class="math notranslate nohighlight">\(M_T\)</span> the number of timesteps (<code class="docutils literal notranslate"><span class="pre">production_steps</span></code>).</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../examples/H-He_Mixture.html" class="btn btn-neutral float-right" title="H-He Mixture Simulation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="input_file.html" class="btn btn-neutral float-left" title="Input File" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, MurilloGroup.
      <span class="lastupdated">
        Last updated on Feb, 07, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #18453b;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #535054;
    }
    .wy-menu-vertical p.caption {
	  color: #fff;
	}
	.wy-menu-vertical a {
	  color: #eee;
	}
	.wy-menu-vertical a:hover {
    background-color: #18453b;
  }
/*  .wy-nav-content {
    max-width: 900px !important;
  }*/
}
  </style>


</body>
</html>
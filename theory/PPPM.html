  
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

<meta property="og:title" content="Particle-Particle Particle-Mesh Algorithm" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="https://murillo-group.github.io/sarkas/theory/PPPM.html" />
  
<meta property="og:site_name" content="SARKAS: Python MD code for plasma physics" />
  
<meta property="og:description" content="The Particle-Particle Particle-Mesh (PPPM or P3M) algorithm is a Fourier-based Ewald summation method formulated by Hockney and Eastwood in the late 1980s. Ewald Sum: The Ewald summation is a metho..." />
  
<meta property="twitter:card" content="summary">
<meta property="twitter:title" content="SARKAS: Python MD code for plasma physics">
<meta property="twitter:description" content="A fast pure-Python molecular dynamics suite for non-ideal plasmas.">
    <title>Particle-Particle Particle-Mesh Algorithm &#8212; Sarkas 1.1.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=RocknRoll+One&display=swap" />
    <link rel="stylesheet" type="text/css" href="../_static/my-style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" href="../_static/my-styles.css" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
  
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Force Error" href="force_error.html" />
    <link rel="prev" title="Theoretical Background" href="theory.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/Sarkas_v1_for_dark_bg.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    SARKAS: Python MD code for plasma physics
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Documentation:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/why_sarkas.html">
   Why Sarkas
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../documentation/get_started.html">
   Get Started
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../documentation/Tutorial_NB/Quickstart.html">
     Quickstart
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../documentation/tutorial.html">
     Tutorial
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../documentation/input_file.html">
       Input File
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../documentation/Tutorial_NB/Pre_Simulation_Testing.html">
       Pre Simulation Testing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../documentation/Tutorial_NB/Simulation_Docs.html">
       Running a Simulation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../documentation/Tutorial_NB/Post_Processing_Docs.html">
       Data Analysis
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../documentation/features.html">
   Available Features
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../documentation/Features_files/integrators.html">
     Integrators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../documentation/Features_files/Berendsen_NB/Berendsen_Thermostat.html">
     Thermostats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../documentation/Features_files/potentials.html">
     Potentials
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Theory:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="theory.html">
   Theoretical Background
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Particle-Particle Particle-Mesh Algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="force_error.html">
     Force Error
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="coupling_constant.html">
     Coupling Constant
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="electron_properties.html">
     Electron Properties
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="references.html">
     References
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Code Dev:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../code_development/code_dev.html">
   Code Development
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../code_development/dev_setup.html">
     Setup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../code_development/dev_report_issues.html">
     Reporting Issues
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../code_development/dev_docs.html">
     Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../code_development/dev_contributing.html">
     Contributing to Sarkas
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Simulations:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../examples/examples.html">
   Examples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/OCP/OCP.html">
     One Component Plasma (OCP)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/BIM/H-He_Mixture.html">
     H-He Mixture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/QSP/QSP_Tutorial.html">
     Quantum Statistical Potential Simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/Magnetized_OCP/Magnetized_Plasma.html">
     Magnetized Plasma
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/Yukawa_vs_EGS/Yukawa_vs_Exact-Gradient_Corrected_Potential.html">
     Yukawa vs Egs potential
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/Moliere/Moliere_Simulation.html">
     Moliere Potential
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/UNP/UCP_Experiment_Validation.html">
     MD for Experiment Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/Ultrafast_EC/Ultrafast_EC_Validation.html">
     Ultrafast electron cooling in an expanding ultracold plasma
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api/api.html">
   API reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/core_pckg/sarkas.core.html">
     sarkas.core
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/core_pckg/sarkas.core.Parameters.html">
       sarkas.core.Parameters
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.__init__.html">
         sarkas.core.Parameters.__init__
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.calc_coupling_constant.html">
         sarkas.core.Parameters.calc_coupling_constant
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.calc_electron_properties.html">
         sarkas.core.Parameters.calc_electron_properties
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.calc_magnetic_parameters.html">
         sarkas.core.Parameters.calc_magnetic_parameters
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.calc_parameters.html">
         sarkas.core.Parameters.calc_parameters
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.check_units.html">
         sarkas.core.Parameters.check_units
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.create_species_arrays.html">
         sarkas.core.Parameters.create_species_arrays
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.from_dict.html">
         sarkas.core.Parameters.from_dict
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.pretty_print.html">
         sarkas.core.Parameters.pretty_print
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.set_species_attributes.html">
         sarkas.core.Parameters.set_species_attributes
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.setup.html">
         sarkas.core.Parameters.setup
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Parameters_mthds/sarkas.core.Parameters.sim_box_setup.html">
         sarkas.core.Parameters.sim_box_setup
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/core_pckg/sarkas.processes.html">
     sarkas.processes
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/core_pckg/sarkas.processes.PostProcess.html">
       sarkas.processes.PostProcess
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
      <label for="toctree-checkbox-11">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PostProcess_mthds/sarkas.processes.PostProcess.__init__.html">
         sarkas.processes.PostProcess.__init__
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PostProcess_mthds/sarkas.processes.PostProcess.common_parser.html">
         sarkas.processes.PostProcess.common_parser
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PostProcess_mthds/sarkas.processes.PostProcess.evolve_loop.html">
         sarkas.processes.PostProcess.evolve_loop
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PostProcess_mthds/sarkas.processes.PostProcess.initialization.html">
         sarkas.processes.PostProcess.initialization
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PostProcess_mthds/sarkas.processes.PostProcess.run.html">
         sarkas.processes.PostProcess.run
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PostProcess_mthds/sarkas.processes.PostProcess.setup.html">
         sarkas.processes.PostProcess.setup
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PostProcess_mthds/sarkas.processes.PostProcess.setup_from_simulation.html">
         sarkas.processes.PostProcess.setup_from_simulation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/core_pckg/sarkas.processes.PreProcess.html">
       sarkas.processes.PreProcess
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
      <label for="toctree-checkbox-12">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.__init__.html">
         sarkas.processes.PreProcess.__init__
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.analytical_approx_pppm.html">
         sarkas.processes.PreProcess.analytical_approx_pppm
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.common_parser.html">
         sarkas.processes.PreProcess.common_parser
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.evolve_loop.html">
         sarkas.processes.PreProcess.evolve_loop
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.green_function_timer.html">
         sarkas.processes.PreProcess.green_function_timer
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.initialization.html">
         sarkas.processes.PreProcess.initialization
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.make_color_map.html">
         sarkas.processes.PreProcess.make_color_map
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.make_fit_plot.html">
         sarkas.processes.PreProcess.make_fit_plot
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.make_force_v_timing_plot.html">
         sarkas.processes.PreProcess.make_force_v_timing_plot
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.make_lagrangian_plot.html">
         sarkas.processes.PreProcess.make_lagrangian_plot
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.make_line_plot.html">
         sarkas.processes.PreProcess.make_line_plot
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.make_pppm_color_map.html">
         sarkas.processes.PreProcess.make_pppm_color_map
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.make_pppm_line_plot.html">
         sarkas.processes.PreProcess.make_pppm_line_plot
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.make_timing_plots.html">
         sarkas.processes.PreProcess.make_timing_plots
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.postproc_estimates.html">
         sarkas.processes.PreProcess.postproc_estimates
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.pppm_approximation.html">
         sarkas.processes.PreProcess.pppm_approximation
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.remove_preproc_dumps.html">
         sarkas.processes.PreProcess.remove_preproc_dumps
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.run.html">
         sarkas.processes.PreProcess.run
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.setup.html">
         sarkas.processes.PreProcess.setup
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.time_acceleration.html">
         sarkas.processes.PreProcess.time_acceleration
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.time_evolution_loop.html">
         sarkas.processes.PreProcess.time_evolution_loop
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.time_n_space_estimates.html">
         sarkas.processes.PreProcess.time_n_space_estimates
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/PreProcess_mthds/sarkas.processes.PreProcess.timing_study_calculation.html">
         sarkas.processes.PreProcess.timing_study_calculation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/core_pckg/sarkas.processes.Process.html">
       sarkas.processes.Process
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
      <label for="toctree-checkbox-13">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Process_mthds/sarkas.processes.Process.__init__.html">
         sarkas.processes.Process.__init__
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Process_mthds/sarkas.processes.Process.common_parser.html">
         sarkas.processes.Process.common_parser
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Process_mthds/sarkas.processes.Process.evolve_loop.html">
         sarkas.processes.Process.evolve_loop
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Process_mthds/sarkas.processes.Process.initialization.html">
         sarkas.processes.Process.initialization
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Process_mthds/sarkas.processes.Process.setup.html">
         sarkas.processes.Process.setup
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/core_pckg/sarkas.processes.Simulation.html">
       sarkas.processes.Simulation
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.__init__.html">
         sarkas.processes.Simulation.__init__
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.check_restart.html">
         sarkas.processes.Simulation.check_restart
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.common_parser.html">
         sarkas.processes.Simulation.common_parser
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.equilibrate.html">
         sarkas.processes.Simulation.equilibrate
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.evolve_loop.html">
         sarkas.processes.Simulation.evolve_loop
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.initialization.html">
         sarkas.processes.Simulation.initialization
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.magnetize.html">
         sarkas.processes.Simulation.magnetize
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.produce.html">
         sarkas.processes.Simulation.produce
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.run.html">
         sarkas.processes.Simulation.run
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/core_pckg/Simulation_mthds/sarkas.processes.Simulation.setup.html">
         sarkas.processes.Simulation.setup
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.html">
     sarkas.potentials
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.core.html">
       sarkas.potentials.core
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
      <label for="toctree-checkbox-16">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.core.Potential.html">
         sarkas.potentials.core.Potential
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.coulomb.html">
       sarkas.potentials.coulomb
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.coulomb.pretty_print_info.html">
         sarkas.potentials.coulomb.pretty_print_info
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.coulomb.update_params.html">
         sarkas.potentials.coulomb.update_params
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.egs.html">
       sarkas.potentials.egs
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
      <label for="toctree-checkbox-18">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.egs.pretty_print_info.html">
         sarkas.potentials.egs.pretty_print_info
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.egs.update_params.html">
         sarkas.potentials.egs.update_params
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.force_pm.html">
       sarkas.potentials.force_pm
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.force_pp.html">
       sarkas.potentials.force_pp
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.hs_yukawa.html">
       sarkas.potentials.hs_yukawa
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
      <label for="toctree-checkbox-19">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.hs_yukawa.pretty_print_info.html">
         sarkas.potentials.hs_yukawa.pretty_print_info
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.hs_yukawa.update_params.html">
         sarkas.potentials.hs_yukawa.update_params
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.lennardjones.html">
       sarkas.potentials.lennardjones
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
      <label for="toctree-checkbox-20">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.lennardjones.pretty_print_info.html">
         sarkas.potentials.lennardjones.pretty_print_info
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.lennardjones.update_params.html">
         sarkas.potentials.lennardjones.update_params
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.moliere.html">
       sarkas.potentials.moliere
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
      <label for="toctree-checkbox-21">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.moliere.update_params.html">
         sarkas.potentials.moliere.update_params
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.qsp.html">
       sarkas.potentials.qsp
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
      <label for="toctree-checkbox-22">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.qsp.pretty_print_info.html">
         sarkas.potentials.qsp.pretty_print_info
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.qsp.update_params.html">
         sarkas.potentials.qsp.update_params
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.tests.html">
       sarkas.potentials.tests
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
      <label for="toctree-checkbox-23">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.tests.test_coulomb.html">
         sarkas.potentials.tests.test_coulomb
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.tests.test_egs.html">
         sarkas.potentials.tests.test_egs
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.tests.test_force_pm.html">
         sarkas.potentials.tests.test_force_pm
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.tests.test_force_pp.html">
         sarkas.potentials.tests.test_force_pp
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.tests.test_lennardjones.html">
         sarkas.potentials.tests.test_lennardjones
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.tests.test_moliere.html">
         sarkas.potentials.tests.test_moliere
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.tests.test_qsp.html">
         sarkas.potentials.tests.test_qsp
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.tests.test_yukawa.html">
         sarkas.potentials.tests.test_yukawa
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.yukawa.html">
       sarkas.potentials.yukawa
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
      <label for="toctree-checkbox-24">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.yukawa.pretty_print_info.html">
         sarkas.potentials.yukawa.pretty_print_info
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/potentials_subpckg/sarkas.potentials.yukawa.update_params.html">
         sarkas.potentials.yukawa.update_params
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/time_evolution_subpckg/sarkas.time_evolution.html">
     sarkas.time_evolution
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
    <label for="toctree-checkbox-25">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/time_evolution_subpckg/sarkas.time_evolution.integrators.html">
       sarkas.time_evolution.integrators
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
      <label for="toctree-checkbox-26">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/time_evolution_subpckg/sarkas.time_evolution.integrators.Integrator.html">
         sarkas.time_evolution.integrators.Integrator
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/time_evolution_subpckg/sarkas.time_evolution.thermostats.html">
       sarkas.time_evolution.thermostats
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
      <label for="toctree-checkbox-27">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/time_evolution_subpckg/sarkas.time_evolution.thermostats.Thermostat.html">
         sarkas.time_evolution.thermostats.Thermostat
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.html">
     sarkas.tools
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/>
    <label for="toctree-checkbox-28">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.html">
       sarkas.tools.observables
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/>
      <label for="toctree-checkbox-29">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.arg_update_doc.html">
         sarkas.tools.observables.arg_update_doc
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.calc_Skw.html">
         sarkas.tools.observables.calc_Skw
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.calc_diff_flux_acf.html">
         sarkas.tools.observables.calc_diff_flux_acf
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.calc_moments.html">
         sarkas.tools.observables.calc_moments
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.calc_nkt.html">
         sarkas.tools.observables.calc_nkt
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.calc_pressure_tensor.html">
         sarkas.tools.observables.calc_pressure_tensor
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.calc_vacf.html">
         sarkas.tools.observables.calc_vacf
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.calc_vkt.html">
         sarkas.tools.observables.calc_vkt
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.calculate_herm_coeff.html">
         sarkas.tools.observables.calculate_herm_coeff
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.col_mapper.html">
         sarkas.tools.observables.col_mapper
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.compute_doc.html">
         sarkas.tools.observables.compute_doc
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.grad_expansion.html">
         sarkas.tools.observables.grad_expansion
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.kspace_setup.html">
         sarkas.tools.observables.kspace_setup
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.load_from_restart.html">
         sarkas.tools.observables.load_from_restart
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.plot_labels.html">
         sarkas.tools.observables.plot_labels
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.setup_doc.html">
         sarkas.tools.observables.setup_doc
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.CurrentCorrelationFunction.html">
         sarkas.tools.observables.CurrentCorrelationFunction
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.DiffusionFlux.html">
         sarkas.tools.observables.DiffusionFlux
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.DynamicStructureFactor.html">
         sarkas.tools.observables.DynamicStructureFactor
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.ElectricCurrent.html">
         sarkas.tools.observables.ElectricCurrent
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.Observable.html">
         sarkas.tools.observables.Observable
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.PressureTensor.html">
         sarkas.tools.observables.PressureTensor
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.RadialDistributionFunction.html">
         sarkas.tools.observables.RadialDistributionFunction
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.StaticStructureFactor.html">
         sarkas.tools.observables.StaticStructureFactor
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.Thermodynamics.html">
         sarkas.tools.observables.Thermodynamics
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.VelocityAutoCorrelationFunction.html">
         sarkas.tools.observables.VelocityAutoCorrelationFunction
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.observables.VelocityDistribution.html">
         sarkas.tools.observables.VelocityDistribution
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.transport.html">
       sarkas.tools.transport
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/>
      <label for="toctree-checkbox-30">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/tools_subpckg/sarkas.tools.transport.TransportCoefficients.html">
         sarkas.tools.transport.TransportCoefficients
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.html">
     sarkas.utilities
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/>
    <label for="toctree-checkbox-31">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.exceptions.html">
       sarkas.utilities.exceptions
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/>
      <label for="toctree-checkbox-32">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.exceptions.AlgorithmError.html">
         sarkas.utilities.exceptions.AlgorithmError
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.exceptions.AlgorithmWarning.html">
         sarkas.utilities.exceptions.AlgorithmWarning
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.exceptions.ParticlesError.html">
         sarkas.utilities.exceptions.ParticlesError
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.exceptions.ParticlesWarning.html">
         sarkas.utilities.exceptions.ParticlesWarning
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.exceptions.PhysicsWarning.html">
         sarkas.utilities.exceptions.PhysicsWarning
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.exceptions.SarkasError.html">
         sarkas.utilities.exceptions.SarkasError
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.exceptions.SarkasWarning.html">
         sarkas.utilities.exceptions.SarkasWarning
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.exceptions.TimerError.html">
         sarkas.utilities.exceptions.TimerError
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.fdints.html">
       sarkas.utilities.fdints
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/>
      <label for="toctree-checkbox-33">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.fdints.fd_doc_hparams.html">
         sarkas.utilities.fdints.fd_doc_hparams
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.fdints.fd_doc_iparams.html">
         sarkas.utilities.fdints.fd_doc_iparams
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.fdints.fermidirac_integral.html">
         sarkas.utilities.fdints.fermidirac_integral
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.io.html">
       sarkas.utilities.io
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" type="checkbox"/>
      <label for="toctree-checkbox-34">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.io.alpha_to_int.html">
         sarkas.utilities.io.alpha_to_int
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.io.convert_bytes.html">
         sarkas.utilities.io.convert_bytes
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.io.num_sort.html">
         sarkas.utilities.io.num_sort
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.io.InputOutput.html">
         sarkas.utilities.io.InputOutput
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.maths.html">
       sarkas.utilities.maths
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" type="checkbox"/>
      <label for="toctree-checkbox-35">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.maths.betamp.html">
         sarkas.utilities.maths.betamp
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.maths.correlationfunction.html">
         sarkas.utilities.maths.correlationfunction
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.maths.force_error_analytic_lcl.html">
         sarkas.utilities.maths.force_error_analytic_lcl
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.maths.force_error_analytic_pp.html">
         sarkas.utilities.maths.force_error_analytic_pp
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.maths.force_error_approx_pm.html">
         sarkas.utilities.maths.force_error_approx_pm
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.maths.force_error_approx_pppm.html">
         sarkas.utilities.maths.force_error_approx_pppm
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.maths.yukawa_green_function.html">
         sarkas.utilities.maths.yukawa_green_function
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.tests.html">
       sarkas.utilities.tests
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" type="checkbox"/>
      <label for="toctree-checkbox-36">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.tests.test_fdints.html">
         sarkas.utilities.tests.test_fdints
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.tests.test_maths.html">
         sarkas.utilities.tests.test_maths
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.timing.html">
       sarkas.utilities.timing
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" type="checkbox"/>
      <label for="toctree-checkbox-37">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/util_subpckg/sarkas.utilities.timing.SarkasTimer.html">
         sarkas.utilities.timing.SarkasTimer
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Credits:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../credits/credits.html">
   Credits
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" type="checkbox"/>
  <label for="toctree-checkbox-38">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../credits/pub_research.html">
     Publications
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../credits/team.html">
     Dev Team
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/murillo-group/sarkas/"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/theory/PPPM.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Content
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Ewald-Sum">
   Ewald Sum
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Total-charge-density">
     Total charge density
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Short-range-term">
     Short-range term
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Long-range-term">
     Long-range term
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Assigning-charges-onto-the-mesh">
   Assigning charges onto the mesh
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Algorithm">
     Algorithm
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Particle-Particle Particle-Mesh Algorithm</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Content </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Ewald-Sum">
   Ewald Sum
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Total-charge-density">
     Total charge density
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Short-range-term">
     Short-range term
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Long-range-term">
     Long-range term
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Assigning-charges-onto-the-mesh">
   Assigning charges onto the mesh
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Algorithm">
     Algorithm
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Particle-Particle-Particle-Mesh-Algorithm">
<h1>Particle-Particle Particle-Mesh Algorithm<a class="headerlink" href="#Particle-Particle-Particle-Mesh-Algorithm" title="Permalink to this headline">#</a></h1>
<p>The Particle-Particle Particle-Mesh (PPPM or P3M) algorithm is a Fourier-based Ewald summation method formulated by Hockney and Eastwood in the late 1980s.</p>
<section id="Ewald-Sum">
<h2>Ewald Sum<a class="headerlink" href="#Ewald-Sum" title="Permalink to this headline">#</a></h2>
<p>The Ewald summation is a method to compute the potential energy of long-range interaction in periodic systems. More details can be found in this Wikipedia <a class="reference external" href="https://en.wikipedia.org/wiki/Ewald_summation">article</a>. In the following we will concentrate on explaining how it is used in the context of Sarkas.</p>
<p>Long range forces are calculated using the Ewald method which consists in dividing the potential into a short and a long range part. Physically this is equivalent to adding and subtracting a screening cloud around each charge. This screening cloud is usually chosen to be given by a Gaussian charged density distribution, but it need not be. The primary reason for choosing a Gaussian is its spherical symmetry. In the following we will calculate the charge density with its surrounding clouds and
the corresponding energy density of each.</p>
<section id="Total-charge-density">
<h3>Total charge density<a class="headerlink" href="#Total-charge-density" title="Permalink to this headline">#</a></h3>
<p>Consider a system of <span class="math notranslate nohighlight">\(N\)</span> randomly distributed charges whose distribution is given by</p>
<div class="math notranslate nohighlight">
\[\rho_N ( \mathbf r) = \sum_{i = 1}^{N} q_i \delta( \mathbf r - \mathbf r_i).\]</div>
<p>At each point <span class="math notranslate nohighlight">\(\mathbf r_i\)</span> we add and substract a Gaussian screening cloud</p>
<div class="math notranslate nohighlight">
\[\rho_S (\mathbf r) = -\frac{q_i \alpha^{3/2}}{\pi} e^{-\alpha^2 (\mathbf r - \mathbf r_i)^2}.\]</div>
<p>The total charge density at point <span class="math notranslate nohighlight">\(\mathbf r\)</span> is then</p>
<div class="math notranslate nohighlight">
\[\rho(\mathbf r) = \sum_{i}^N  \left \{ \left ( q_i\delta( \mathbf r - \mathbf r_i) - \frac{q_i\alpha^{3/2}}{\pi} e^{-\alpha^2 \left( \mathbf r - \mathbf r_i \right )^2 } \right ) + \frac{q_i\alpha^{3/2}}{\pi} e^{-\alpha^2 \left( \mathbf r- \mathbf r_i \right )^2 } \right \},\]</div>
<p>where, again, the first term is the charge density due to the real particles and the last two terms are the negative and positive screening clouds. The first two terms are in parenthesis to emphasizes the splitting into</p>
<div class="math notranslate nohighlight">
\[\rho(\mathbf r)  = \rho_{\mathcal R}(\mathbf r) + \rho_{\mathcal F}(\mathbf r)\]</div>
<div class="math notranslate nohighlight">
\[\rho_{\mathcal R} (\mathbf r) = \sum_{i}^N \left ( q_i\delta( \mathbf r- \mathbf r_i) - \frac{q_i\alpha^{3/2}}{\pi} e^{-\alpha^2 \left( \mathbf r- \mathbf r_i \right )^2 } \right ), \quad \rho_{\mathcal F}(\mathbf r) = \sum_{i}^N \frac{q_i\alpha^{3/2}}{\pi} e^{-\alpha^2 \left( \mathbf r- \mathbf r_i \right )^2 }\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho_{\mathcal R}(\mathbf r)\)</span> indicates the charge density leading to the short range part of the potential and <span class="math notranslate nohighlight">\(\rho_{\mathcal F}(\mathbf r)\)</span> leading to the long range part. The subscripts <span class="math notranslate nohighlight">\(\mathcal R, \mathcal F\)</span> stand for Real and Fourier space indicating the way the calculation will be done.</p>
<p>The potential at every point <span class="math notranslate nohighlight">\(\mathbf r\)</span> is calculated from Poissons equation</p>
<div class="math notranslate nohighlight">
\[-\nabla^2 \phi( \mathbf r) = 4\pi \rho_{\mathcal R} (\mathbf r) + 4\pi \rho_{\mathcal F}( \mathbf r).\]</div>
</section>
<section id="Short-range-term">
<h3>Short-range term<a class="headerlink" href="#Short-range-term" title="Permalink to this headline">#</a></h3>
<p>The short range term is calculated in the usual way</p>
<div class="math notranslate nohighlight">
\[-\nabla^2 \phi_{\mathcal R}( \mathbf r) = 4\pi \sum_{i}^N  \left ( q_i\delta( \mathbf r- \mathbf r_i) - \frac{q_i\alpha^{3/2}}{\pi} e^{-\alpha^2 \left( \mathbf r- \mathbf r_i \right )^2 } \right ).\]</div>
<p>The first term <span class="math notranslate nohighlight">\(\delta(\mathbf r - \mathbf r_i)\)</span> leads to the usual Coulomb potential (<span class="math notranslate nohighlight">\(\sim 1/r\)</span>) while the Gaussian leads to the error function</p>
<div class="math notranslate nohighlight">
\[\phi_{\mathcal R}( \mathbf r ) = \sum_i^N  \frac{q_i}{r} - \frac{q_i}{r}\text{erf} (\alpha r)  = \sum_i^N \frac{q_i}{r} \text{erfc}(\alpha r)\]</div>
<p>(eq:phi_R)</p>
</section>
<section id="Long-range-term">
<h3>Long-range term<a class="headerlink" href="#Long-range-term" title="Permalink to this headline">#</a></h3>
<p>The long range term is calculated in Fourier space</p>
<div class="math notranslate nohighlight">
\[k^2 \tilde\phi_{\mathcal F}(k) = 4\pi \tilde\rho_{\mathcal F}(k)\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\tilde\rho_{\mathcal F}(k) = \frac{1}{V} \int d\mathbf re^{- i \mathbf k \cdot \mathbf r} \rho_{\mathcal F}( \mathbf r ) = \sum_{i}^N \frac{q_i\alpha^{3/2}}{\pi V} \int d\mathbf r e^{- i \mathbf k \cdot \mathbf r}  e^{-\alpha^2 \left( \mathbf r - \mathbf r_i \right )^2 } = \sum_{i}^N \frac{q_i}{V} e^{-i \mathbf k \cdot \mathbf r_i} e^{-k^2/(4\alpha^2)}.\]</div>
<p>The potential is then</p>
<div class="math notranslate nohighlight">
\[\tilde \phi_{\mathcal F}(\mathbf k) = \frac{4\pi}{k^2} \frac{1}{V} \sum_{i}^N q_i e^{-i\mathbf k \cdot \mathbf r_i} e^{-k^2/(4\alpha^2)} = \frac{1}{V} \sum_i^N v(k)e^{-k^2/(4 \alpha^2)} q_i e^{-i \mathbf k \cdot \mathbf r_i}\]</div>
<p>and in real space</p>
<div class="math notranslate nohighlight">
\[\phi_{\mathcal R}( \mathbf r ) = \sum_{\mathbf k \neq 0} \tilde \phi_{\mathcal F}(\mathbf k)e^{i \mathbf k \cdot \mathbf r} = \frac{1}{V} \sum_{\mathbf k\neq 0} \sum_{i}^N v(k) e^{-k^2/(4\alpha^2)}q_i e^{i \mathbf k \cdot ( \mathbf r- \mathbf r_i) },\]</div>
<p>(eq:U_R)</p>
<p>where the <span class="math notranslate nohighlight">\(\mathbf k = 0\)</span> is removed from the sum because of the overall charge neutrality.</p>
<p>The potential energy created by this long range part is</p>
<div class="math notranslate nohighlight">
\[U_{\mathcal F} = \frac {1}{2} \sum_i^N q_i \phi_{\mathcal F}(\mathbf r_i) = \frac{1}{2} \frac{1}{V} \sum_{i,j}^N q_i q_j \sum_{\mathbf k \neq 0 } v(k)  e^{-k^2/(4\alpha^2)}e^{i \mathbf k \cdot ( \mathbf r_i - \mathbf r_j) } = \frac{1}{2} \sum_{\mathbf k \neq 0} |\rho_0(\mathbf k)|^2 v(k) e^{-k^2/(4\alpha^2)},\]</div>
<p>(eq:U_F)</p>
<p>where I used the definition of the charge density</p>
<div class="math notranslate nohighlight">
\[\rho_0(\mathbf k) = \frac 1V \sum_i^N q_i e^{i \mathbf k \cdot \mathbf r_i}.\]</div>
<p>However, in the above sum we are including the self-energy term, i.e.<span class="math notranslate nohighlight">\(\mathbf r_i = \mathbf r_j\)</span>. This term can be easily calculated and then removed from <span class="math notranslate nohighlight">\(U_{\mathcal F}\)</span></p>
<div class="math notranslate nohighlight">
\[\frac{\mathcal Q^2}{2V} \sum_{\mathbf k} \frac{4\pi}{k^2} e^{-k^2/(4\alpha^2)} \rightarrow \frac{\mathcal Q^2}{2V} \left ( \frac{L}{2\pi} \right )^3 \int dk (4\pi)^2 e^{-k^2/(4\alpha^2) }  = \mathcal Q^2 \frac{(4\pi)^2}{2V} \left ( \frac{L}{2\pi} \right )^3 \sqrt{\pi } \alpha = \mathcal Q^2 \frac{\alpha}{\sqrt{\pi} }\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal Q^2 = \sum_i^N q_i^2\)</span>, note that in the integral we have re-included <span class="math notranslate nohighlight">\(\mathbf k = 0\)</span>, but this is not a problem. Finally the long-range potential energy is</p>
<div class="math notranslate nohighlight">
\[U_{\mathcal L} = U_{\mathcal F} - \mathcal Q^2 \frac{\alpha}{\sqrt{\pi} }.\]</div>
<p>(eq:phi_L)</p>
<p>At to this point we have the analytical expression for our potential; {eq}<code class="docutils literal notranslate"><span class="pre">eq:U_R</span></code> and {eq}<code class="docutils literal notranslate"><span class="pre">eq:U_F</span></code>. However, computing the sum over <span class="math notranslate nohighlight">\(\mathbf k\)</span> in the equation for <span class="math notranslate nohighlight">\(U_{\mathcal F}\)</span> is still too slow and we dont know what value of <span class="math notranslate nohighlight">\(\mathbf k\)</span> to end the sum.</p>
</section>
</section>
<section id="Assigning-charges-onto-the-mesh">
<h2>Assigning charges onto the mesh<a class="headerlink" href="#Assigning-charges-onto-the-mesh" title="Permalink to this headline">#</a></h2>
<p>The idea of particle-mesh algorithms is to speed up the calculation of the reciprocal (space) potential <span class="math notranslate nohighlight">\(U_{\mathcal F}\)</span> by calculating it on a mesh. However, the particles are scattered at random points in space so we need to distribute them onto the mesh points. For simplicity, we assume the number of grid points <span class="math notranslate nohighlight">\(M\)</span> to be identical in all three directions <span class="math notranslate nohighlight">\(M = M_x = M_y = M_z\)</span>. Define the spacing between two grid points <span class="math notranslate nohighlight">\(h = L/M\)</span> and <span class="math notranslate nohighlight">\(\mathbb{M}\)</span> the set of all
grid points:</p>
<div class="math notranslate nohighlight">
\[\mathbb{M} = \left \{ \mathbf mh \; : \mathbf m \in \mathbb{Z}^3 \; \textrm{and} \; 0 \leq m_{x,y,z} &lt; M \right \}.\]</div>
<p>The charge density of the mesh, <span class="math notranslate nohighlight">\(\rho_M(\mathbf r)\)</span>, is calculated by</p>
<div class="math notranslate nohighlight">
\[\rho_{M}(\mathbf r) = \int U_p(\mathbf r - \mathbf r') \rho(\mathbf r') d\mathbf r', \quad U_p(\mathbf r) = h^{-3} W_p(\mathbf r), \quad  \mathbf r \in \mathbb{M}\]</div>
<p>where <span class="math notranslate nohighlight">\(W_p(\mathbf r)\)</span> is the charge assignment function of order <span class="math notranslate nohighlight">\(p \in \mathbb{N}^+\)</span>. In Sarkas we chose it to be a cardinal B-spline with a Fourier transform</p>
<div class="math notranslate nohighlight">
\[\tilde W_{p}(\mathbf k) = h^3 \left [ \frac{\sin(k_xh/2)}{k_x h/2} \frac{\sin(k_y h/2)}{k_y h/2} \frac{\sin(k_z h/2)}{k_z h/2} \right ]^p.\]</div>
<p>Substituting the above into <span class="math notranslate nohighlight">\(\rho_M(\mathbf r)\)</span> we find</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{eqnarray}
    \rho_M (\mathbf r) &amp; = &amp; \int d\mathbf r' h^{-3} W( \mathbf r - \mathbf r')\sum_{i} q_i \delta(\mathbf r' - \mathbf r_i), \\
    &amp; = &amp; h^{-3} \sum_{i} q_i  W( \mathbf r - \mathbf r_i).
\end{eqnarray}\end{split}\]</div>
<p>except at the boundaries where the periodicity has to be properly taken into account.</p>
<section id="Algorithm">
<h3>Algorithm<a class="headerlink" href="#Algorithm" title="Permalink to this headline">#</a></h3>
<p>The routine to deposit charges onto the grid is the following,</p>
<ol class="arabic simple">
<li><p>Assume the particle is at position <span class="math notranslate nohighlight">\(x_i\)</span>.</p></li>
<li><p>Choose the charge assignment order <span class="math notranslate nohighlight">\(p\)</span>,</p></li>
<li><p>Find the coordinate of the closest mesh point to the particles location, if <span class="math notranslate nohighlight">\(p\)</span> is odd. If <span class="math notranslate nohighlight">\(p\)</span> is even take the coordinate of the midpoint of between the two nearest mesh points. Denote this by <span class="math notranslate nohighlight">\(x_m\)</span></p></li>
<li><p>Find the <span class="math notranslate nohighlight">\(p\)</span> mesh points that are closest to the particle, starting from the far left.</p></li>
<li><p>The fraction of charge to be deposited on each point is given by <span class="math notranslate nohighlight">\(W_p(x_i - x_m)\)</span>.</p></li>
</ol>
<p>In the following I will show how to do this in the case of</p>
<ol class="arabic simple">
<li><p>two particles on a 1D mesh <a class="reference external" href="#example_1d">jump to it</a>,</p></li>
<li><p>one particle on a 2D mesh, <a class="reference external" href="#example_2D">jump to it</a>,</p></li>
<li><p><span class="math notranslate nohighlight">\(N\)</span> particles on a 2D mesh using Sarkas functions, <a class="reference external" href="#example_N">jump to it</a></p></li>
</ol>
<p>### 1D Numerical example</p>
<p>In the following we show a 1D example by calculating <span class="math notranslate nohighlight">\(W_p(x)\)</span> for two particles each with a different <span class="math notranslate nohighlight">\(p\)</span>. We position the particles near the edges to show the periodic boundary conditions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the usual stuff</span>
<span class="o">%</span><span class="k">pylab</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;MSUstyle&quot;</span><span class="p">)</span>

<span class="c1"># Random number generator</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">123456789</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sarkas.potentials.force_pm</span> <span class="kn">import</span> <span class="n">assgnmnt_func</span><span class="p">,</span> <span class="n">calc_charge_dens</span><span class="p">,</span> <span class="n">mesh_point_shift</span><span class="p">,</span> <span class="n">calc_mesh_coord</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Using matplotlib backend: &lt;object object at 0x7faa4afb0c40&gt;
Populating the interactive namespace from numpy and matplotlib
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_1</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1"># position of the particle</span>
<span class="n">x_2</span> <span class="o">=</span> <span class="mf">8.3</span> <span class="c1"># position of the particle</span>
<span class="n">N_mesh_points</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># Grid points</span>
<span class="n">x_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_mesh_points</span><span class="p">)</span>
<span class="c1"># grid spacing, chosen to be 1</span>
<span class="n">hx</span> <span class="o">=</span> <span class="n">x_mesh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot the 1D grid and the particle</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_mesh</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Mesh points&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Particle 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Particle 2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;$x/h$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;$x/h$&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/theory_PPPM_4_1.png" src="../_images/theory_PPPM_4_1.png" />
</div>
</div>
<p>The above plot shows the position of the two particles, represented by Xs, and the location of the mesh points, represented by black dots. Notice that we are rescaling everything by the distance between mesh points, <span class="math notranslate nohighlight">\(h\)</span>, which we choose to be = 1 for simplicity.</p>
<p>The next code cell calculates the function <span class="math notranslate nohighlight">\(W(x)\)</span> which represents the amount of charge to be assigned to each mesh point. Particle 1 is distributed over three points while Particle 2 over four mesh points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the charge assignment function</span>

<span class="c1"># Define the charge assignment order, p</span>
<span class="n">cao1</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">cao2</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Define x_m to be the coordinate of the particle&#39;s nearest mesh point (if cao is odd)</span>
<span class="n">x_m1</span> <span class="o">=</span> <span class="n">rint</span><span class="p">(</span><span class="n">x_1</span><span class="o">/</span><span class="n">hx</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span><span class="p">(</span> <span class="n">cao1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">x_m2</span> <span class="o">=</span> <span class="n">rint</span><span class="p">(</span><span class="n">x_2</span><span class="o">/</span><span class="n">hx</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span><span class="p">(</span> <span class="n">cao2</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="c1"># The above branchless programming is because int gives the integer value only and not the closest integer</span>

<span class="c1"># Distance to the nearest mesh point for p odd</span>
<span class="n">delta_x1</span> <span class="o">=</span> <span class="n">x_1</span><span class="o">/</span><span class="n">hx</span> <span class="o">-</span> <span class="n">x_m1</span>
<span class="c1"># Distance to the midpoint between the two nearest mesh points</span>
<span class="n">delta_x2</span> <span class="o">=</span> <span class="n">x_2</span><span class="o">/</span><span class="n">hx</span> <span class="o">-</span> <span class="n">x_m2</span> <span class="o">-</span> <span class="mf">0.5</span>

<span class="c1"># W_3(x_1 - x_m1), W_5(x_2 - x_m2)</span>
<span class="c1"># This returns an array of length = p.</span>
<span class="c1"># Each element is the fraction of the charge on each of the p mesh points starting from the far left.</span>
<span class="n">wx1</span> <span class="o">=</span> <span class="n">assgnmnt_func</span><span class="p">(</span><span class="n">cao1</span><span class="p">,</span> <span class="n">delta_x1</span><span class="p">)</span>
<span class="n">wx2</span> <span class="o">=</span> <span class="n">assgnmnt_func</span><span class="p">(</span><span class="n">cao2</span><span class="p">,</span> <span class="n">delta_x2</span><span class="p">)</span>

<span class="c1"># Create a long array to plot on the entire x range</span>
<span class="n">full_wx1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_mesh</span><span class="p">)</span> <span class="p">)</span>
<span class="n">full_wx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_mesh</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># Note that you need to shift to the left due to zero indexing</span>
<span class="n">ixn</span> <span class="o">=</span> <span class="n">x_m1</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">cao1</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
<span class="c1"># Calculate the W(x) for the first particle</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cao1</span><span class="p">):</span>
    <span class="c1"># Check for BC</span>
    <span class="k">if</span> <span class="n">ixn</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">ixn</span> <span class="o">+</span> <span class="n">N_mesh_points</span>

    <span class="k">elif</span> <span class="n">ixn</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">N_mesh_points</span> <span class="o">-</span><span class="mi">1</span> <span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">ixn</span> <span class="o">-</span> <span class="n">N_mesh_points</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">ixn</span>

    <span class="n">full_wx1</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">wx1</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
    <span class="n">ixn</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># Note that you need to shift to the left due to zero indexing</span>
<span class="n">ixn</span> <span class="o">=</span> <span class="n">x_m2</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">cao2</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># Calculate the W(x) for the second particle</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cao2</span><span class="p">):</span>
    <span class="c1"># Check for BC</span>
    <span class="k">if</span> <span class="n">ixn</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">ixn</span> <span class="o">+</span> <span class="n">N_mesh_points</span>
    <span class="k">elif</span> <span class="n">ixn</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">N_mesh_points</span> <span class="o">-</span><span class="mi">1</span> <span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">ixn</span> <span class="o">-</span> <span class="n">N_mesh_points</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">ixn</span>

    <span class="n">full_wx2</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">wx2</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
    <span class="n">ixn</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_mesh</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Mesh points&quot;</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>  <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Particle 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_m1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">(),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Particle 1 $x_</span><span class="si">{m1}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_mesh</span><span class="p">,</span> <span class="n">full_wx1</span><span class="p">,</span> <span class="s1">&#39;--o&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">(),</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$W_3(x_1 - x_</span><span class="si">{m1}</span><span class="s2">)$&quot;</span><span class="p">)</span>

<span class="n">p2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>  <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Particle 2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_m2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">(),</span>  <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Particle 2 $x_</span><span class="si">{m2}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_mesh</span><span class="p">,</span> <span class="n">full_wx2</span><span class="p">,</span> <span class="s1">&#39;--o&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">(),</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$W_4(x_2 - x_</span><span class="si">{m2}</span><span class="s2">)$&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$W_p(x)$&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$x/h$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/theory_PPPM_7_0.png" src="../_images/theory_PPPM_7_0.png" />
</div>
</div>
<p>As you can see the first (orange) particle is distributed on the three mesh points (9, 0, 1) while the second (green) particle onto the four mesh points (7, 8, 9, 0).</p>
<p>### 2D Example</p>
<p>The algorithm described above can be extended to 3D and it is what is contained in the function <a class="reference external" href="%60../api/potentials_subpckg/sarkas.potentials.force_pm#calc_charge_dens%60">calc_charge_dens</a>. In the following we will present an example with randomly distributed charges on a 2D plane for visualization.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the charge assignment function</span>

<span class="c1"># Define the charge assignment order, p</span>
<span class="n">cao</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="mf">30.7</span><span class="p">,</span> <span class="mf">28.3</span>

<span class="n">L</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">Mx</span><span class="p">,</span> <span class="n">My</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span>
<span class="n">hx</span><span class="p">,</span> <span class="n">hy</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="n">Mx</span><span class="p">,</span> <span class="n">L</span><span class="o">/</span><span class="n">My</span>

<span class="n">x_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Mx</span><span class="p">)</span>
<span class="n">y_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">My</span><span class="p">)</span>
<span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_ar</span><span class="p">,</span> <span class="n">y_ar</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>

<span class="c1"># Define x_m to be the coordinate of the particle&#39;s nearest mesh point (if cao is odd)</span>
<span class="n">x_m1</span> <span class="o">=</span> <span class="n">rint</span><span class="p">(</span><span class="n">x1</span><span class="o">/</span><span class="n">hx</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span><span class="p">(</span> <span class="n">cao</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">y_m1</span> <span class="o">=</span> <span class="n">rint</span><span class="p">(</span><span class="n">y1</span><span class="o">/</span><span class="n">hy</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span><span class="p">(</span> <span class="n">cao</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="c1"># The above branchless programming is because int gives the integer value only and not the closest integer</span>

<span class="c1"># Distance to the nearest mesh point for p odd or midpoint for p even</span>
<span class="n">delta_x</span> <span class="o">=</span> <span class="n">x1</span><span class="o">/</span><span class="n">hx</span> <span class="o">-</span> <span class="n">x_m1</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span><span class="p">(</span> <span class="n">cao</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">delta_y</span> <span class="o">=</span> <span class="n">y1</span><span class="o">/</span><span class="n">hy</span> <span class="o">-</span> <span class="n">y_m1</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span><span class="p">(</span> <span class="n">cao</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># This returns an array of length = p.</span>
<span class="c1"># Each element is the fraction of the charge on each of the p mesh points starting from the far left.</span>
<span class="n">wx</span> <span class="o">=</span> <span class="n">assgnmnt_func</span><span class="p">(</span><span class="n">cao</span><span class="p">,</span> <span class="n">delta_x</span><span class="p">)</span>
<span class="n">wy</span> <span class="o">=</span> <span class="n">assgnmnt_func</span><span class="p">(</span><span class="n">cao</span><span class="p">,</span> <span class="n">delta_y</span><span class="p">)</span>

<span class="c1"># Create a long array to plot on the entire x range</span>
<span class="n">rho_2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span> <span class="n">xgrid</span><span class="p">)</span>

<span class="c1"># Note that you need to shift to the left due to zero indexing</span>
<span class="n">ixn</span> <span class="o">=</span> <span class="n">x_m1</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">cao</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="mi">1</span>  <span class="o">*</span> <span class="p">(</span><span class="n">cao</span> <span class="o">%</span><span class="k">2</span> == 0) )

<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cao</span><span class="p">):</span>

    <span class="c1"># Check for BC</span>
    <span class="n">index_x</span> <span class="o">=</span> <span class="n">ixn</span> <span class="o">+</span> <span class="n">Mx</span> <span class="o">*</span> <span class="p">(</span><span class="n">ixn</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">Mx</span><span class="o">*</span><span class="p">(</span> <span class="n">ixn</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">Mx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

    <span class="c1"># Note that you need to shift to the left due to zero indexing</span>
    <span class="n">iyn</span> <span class="o">=</span> <span class="n">y_m1</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">cao</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span>  <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">cao</span> <span class="o">%</span><span class="k">2</span> == 0) )

    <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cao</span><span class="p">):</span>
        <span class="c1"># Check for BC</span>
        <span class="n">index_y</span> <span class="o">=</span> <span class="n">iyn</span> <span class="o">+</span> <span class="n">My</span> <span class="o">*</span> <span class="p">(</span><span class="n">iyn</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">My</span><span class="o">*</span><span class="p">(</span> <span class="n">iyn</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">My</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">rho_2D</span><span class="p">[</span><span class="n">index_x</span><span class="p">,</span> <span class="n">index_y</span><span class="p">]</span> <span class="o">+=</span> <span class="n">wx</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">*</span> <span class="n">wy</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span>
        <span class="n">iyn</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ixn</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># I am getting a deprecation warning from matplotlib about the grid in pcolor.</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cbook</span><span class="o">.</span><span class="n">mplDeprecation</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">rho_2D</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\rho_M(x,y)$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Particle&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="p">(</span><span class="n">x_m1</span> <span class="p">)</span><span class="o">*</span><span class="n">hx</span> <span class="p">,</span> <span class="p">(</span><span class="n">y_m1</span> <span class="p">)</span> <span class="o">*</span> <span class="n">hy</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;$(x_m, y_m)$&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Mx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">hx</span><span class="p">)</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">My</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">j</span><span class="o">*</span> <span class="n">hy</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$x$&quot;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$y$&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/theory_PPPM_11_0.png" src="../_images/theory_PPPM_11_0.png" />
</div>
</div>
<p>Lets make the above plot 3D</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;3d&quot;</span><span class="p">})</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">rho_2D</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">plasma</span><span class="p">)</span>
<span class="c1"># Uncomment the following if you want to see images of the rho_m duplicated.</span>
<span class="c1"># ax.plot_surface(xgrid - L, ygrid, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid - L, ygrid - L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid , ygrid - L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid , ygrid + L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid + L , ygrid + L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid + L , ygrid, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid + L , ygrid - L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid - L , ygrid + L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$x$&quot;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$y$&quot;</span><span class="p">,</span> <span class="n">zlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\rho_M(x,y)$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/theory_PPPM_13_0.png" src="../_images/theory_PPPM_13_0.png" />
</div>
</div>
<p>### 2D Example with N particles</p>
<p>Lets extend the above example to <span class="math notranslate nohighlight">\(N = 15\)</span> particles and use Sarkas functions instead.</p>
<ol class="arabic simple">
<li><p>The function <a class="reference external" href="%60../api/potentials_subpckg/sarkas.potentials.force_pm#mesh_point_shift%60">mesh_point_shift</a> calculates the shifts needed if the charge assignment order is even. It returns <code class="docutils literal notranslate"><span class="pre">mid</span></code> and <code class="docutils literal notranslate"><span class="pre">pshift</span></code>. <code class="docutils literal notranslate"><span class="pre">mid</span></code> can be either 0 or 0.5 and it is the equivalent of <code class="docutils literal notranslate"><span class="pre">0.5</span> <span class="pre">*</span> <span class="pre">(</span> <span class="pre">cao</span> <span class="pre">%</span> <span class="pre">2</span> <span class="pre">==</span> <span class="pre">0)</span></code> in the above examples. <code class="docutils literal notranslate"><span class="pre">pshift</span></code> is the shift in the index, equivalent to <code class="docutils literal notranslate"><span class="pre">int(cao/2</span> <span class="pre">-</span> <span class="pre">1</span> <span class="pre">*</span> <span class="pre">(cao%2</span> <span class="pre">==</span> <span class="pre">0))</span></code> in the definition of <code class="docutils literal notranslate"><span class="pre">ixn</span></code>.</p></li>
<li><p>The function <a class="reference external" href="%60../api/potentials_subpckg/sarkas.potentials.force_pm#calc_mesh_coord%60">calc_mesh_coord</a> calculates the mesh coordinates of the particles (<code class="docutils literal notranslate"><span class="pre">mesh_pos</span></code>) and their corresponding indexes (<code class="docutils literal notranslate"><span class="pre">mesh_points</span></code>).</p></li>
<li><p>The function <a class="reference external" href="%60../api/potentials_subpckg/sarkas.potentials.force_pm#calc_charge_dens%60">calc_charge_dens</a> calculates the final charge density <code class="docutils literal notranslate"><span class="pre">rho_m</span></code></p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of particles</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">15</span>
<span class="c1"># Box length</span>
<span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">N</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
<span class="n">box_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span>
<span class="n">box_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Charge assignment order</span>
<span class="n">cao</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1"># Array of mesh points. Note in the case of 2D you still need to pass 1 for the z-mesh</span>
<span class="n">Mx</span><span class="p">,</span> <span class="n">My</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span>
<span class="n">mesh_sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Mx</span><span class="p">,</span> <span class="n">My</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">x_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Mx</span><span class="p">)</span>
<span class="n">y_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">My</span><span class="p">)</span>
<span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_ar</span><span class="p">,</span> <span class="n">y_ar</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>

<span class="c1"># Spacings</span>
<span class="n">h_array</span> <span class="o">=</span> <span class="n">box_lengths</span><span class="o">/</span><span class="n">mesh_sz</span>
<span class="n">h_array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="c1"># print(h_array)</span>

<span class="c1"># Particles positions</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">L</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">pos</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># set the z-coord to 0</span>

<span class="n">charges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="n">N</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>

<span class="c1"># Calculate the shifts due to an even cao</span>
<span class="n">mid</span><span class="p">,</span> <span class="n">pshift</span> <span class="o">=</span> <span class="n">mesh_point_shift</span><span class="p">(</span><span class="n">cao</span><span class="p">)</span>
<span class="c1"># Calculates the mesh coordinates of the particles and the corresponding indexes</span>
<span class="n">mesh_pos</span><span class="p">,</span> <span class="n">mesh_points</span> <span class="o">=</span> <span class="n">calc_mesh_coord</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">h_array</span><span class="p">,</span> <span class="n">cao</span><span class="p">)</span>
<span class="c1"># Calculate the total charge density</span>
<span class="n">rho_m</span> <span class="o">=</span> <span class="n">calc_charge_dens</span><span class="p">(</span><span class="n">mesh_pos</span><span class="p">,</span> <span class="n">mesh_points</span><span class="p">,</span> <span class="n">charges</span><span class="p">,</span> <span class="n">cao</span><span class="p">,</span> <span class="n">mesh_sz</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">pshift</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<p>The first thing to note is the shape of the charge density; it is ( z_mesh, y_mesh, x_mesh). This is a legacy feature that has not been removed.</p>
<p>Lets plot the charge density</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">rho_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">plasma</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\rho_M(x,y)$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Particles&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh_sz</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">i</span><span class="o">*</span> <span class="n">h_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh_sz</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">j</span><span class="o">*</span> <span class="n">h_array</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$x$&quot;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$y$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/theory_PPPM_17_0.png" src="../_images/theory_PPPM_17_0.png" />
</div>
</div>
<p> and its 3D version</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;3d&quot;</span><span class="p">})</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">rho_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">plasma</span><span class="p">)</span>
<span class="c1"># Uncomment the following if you want to see images of the rho_m duplicated.</span>
<span class="c1"># ax.plot_surface(xgrid - L, ygrid, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid - L, ygrid - L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid , ygrid - L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid , ygrid + L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid + L , ygrid + L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid + L , ygrid, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid + L , ygrid - L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="c1"># ax.plot_surface(xgrid - L , ygrid + L, rho_m[0].T, cmap = plt.cm.plasma)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$x$&quot;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$y$&quot;</span><span class="p">,</span> <span class="n">zlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\rho_M(x,y)$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/theory_PPPM_19_0.png" src="../_images/theory_PPPM_19_0.png" />
</div>
</div>
<p>At this point we need only Fourier transform <span class="math notranslate nohighlight">\(\rho_M(x,y,z)\)</span> and solve Poissons equation.</p>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="theory.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Theoretical Background</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="force_error.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Force Error</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By MurilloGroup<br/>
  
      &copy; Copyright 2019-2022, MurilloGroup.<br/>
    Last updated on Apr 08, 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>

 

  <script type="text/javascript">
    jQuery(function () {
        SphinxRtdTheme.Navigation.enable(true);
      })
  </script>

  <style>
    /* Sidebar header (and topbar for mobile) */
    /* .wy-side-nav-search,  */
    .wy-nav-top {
      background: #18453b;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #535054;
    }
    .wy-menu-vertical p.caption {
	  color: #fff;
    }
    .wy-menu-vertical a {
      color: #eee;
    }
    .wy-menu-vertical a:hover {
      background-color: #18453b;
    }
    /* .wy-nav-content {
      max-width: 900px !important;
    } */
  </style>

  </body>
</html>